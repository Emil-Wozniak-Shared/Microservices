//file:noinspection GroovyAssignabilityCheck
plugins {
    id("org.springframework.boot") version "2.5.5"
    id("io.spring.dependency-management") version "1.0.11.RELEASE"
    id "org.jetbrains.kotlin.jvm" version "1.5.31"
    id "org.jetbrains.kotlin.plugin.spring" version "1.5.31"
    id("org.openapi.generator") version "5.2.1"
}

group = "pl.emil"
version = "0.0.1-SNAPSHOT"
sourceCompatibility = 11
targetCompatibility = 11

repositories {
    mavenLocal()
    mavenCentral()
}

def springdoc(target, version = "1.5.11") {
    dependencies {
        implementation("org.springdoc:springdoc-openapi-$target:$version")
    }
}

dependencies {
    springdoc("kotlin")
    springdoc("webflux-ui")

    implementation("org.springframework.boot:spring-boot-starter")
    implementation("org.jetbrains.kotlin:kotlin-reflect")
    implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
    testImplementation("org.springframework.boot:spring-boot-starter-test")
}

tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach {
    kotlinOptions {
        freeCompilerArgs = ["-Xjsr305=strict"]
        jvmTarget = "11"
    }
}

test {
    useJUnitPlatform()
}

openApiGenerate {
    generatorName = "kotlin"
    groupId = "pl.emil"
    packageName = "contract"
    inputSpec = "$rootDir/src/main/resources/api.json".toString()
    outputDir = "$buildDir/generated".toString()
    apiPackage = "pl.emil.api"
    invokerPackage = "pl.emil.invoker"
    modelPackage = "pl.emil.model"
    configOptions = [ dateLibrary: "java8" ]
}
